!function(t,r){function e(t){var r=this,e={autoplay:!0,erase:!0,locale:"detect"};r.options=r.utils.merge(e,t||{}),"detect"===r.options.locale&&(r.options.locale=(window.navigator.languages||["en"])[0].split("-")[0]),r.keyboards[r.options.locale]||(r.options.locale="en"),r.utils.keyboard=r.keyboards[r.options.locale],r.events={},r.scene=-1,r.scenario=[],r.casting={},r.current={},r.state="ready"}e.prototype={constructor:e,version:"1.2.0",keyboards:{},set:function(t,r){var e=this,n=e.current.voice;return e.current.model=t,e.utils.isFunction(n)?n.apply(e,r):n.innerHTML=t,e},getSayingSpeed:function(t,r){"number"!=typeof t&&(r=t,t=0);var e=this,n=e.current.speed+t;n>1&&(n=1);var a=r?n:e.utils.randomFloat(n,1);return e.utils.getPercentageBetween(1e3,50,a)},isMistaking:function(){var t=this;return t.utils.randomFloat(0,1)>t.current.accuracy},parseHTML:function(t){var r=this,e={tag:"",startAt:-1},n=r.utils.copy(e);r.current.htmlStartTags=[],r.current.htmlEndTags=[];for(var a,i,s=0,o=t.length;o>s;s++)a=t.charAt(s),"<"===a&&(n.startAt=s),n.startAt>=0&&(n.tag+=a),">"===a&&(i=r.utils.copy(n),"/"===n.tag.charAt(1)?r.current.htmlEndTags.push(i):r.current.htmlStartTags.push(i),n=r.utils.copy(e));return r},stripHTML:function(t){for(var r=this,e=0,n=r.current.htmlStartTags.length;n>e;e++)t=t.replace(r.current.htmlStartTags[e].tag,"").replace(r.current.htmlEndTags[e].tag,"");return t},injectHTML:function(t,r){for(var e,n,a=this,i=a.current.htmlStartTags.length,s=0,o=0,c=0;i>o;)if(e=a.current.htmlStartTags[o],n=a.current.htmlEndTags[c],e.startAt<n.startAt){if(!(e.startAt<=r+s)){for(var u=o-1;u>=c;u--)t+=a.current.htmlEndTags[u].tag;return t}t=t.substr(0,e.startAt)+e.tag+t.substr(e.startAt),s+=e.tag.length,o++}else{if(!(n.startAt<=r+s))return t;t=t.substr(0,n.startAt)+n.tag+t.substr(n.startAt),s+=n.tag.length,c++}return t},utils:{keyboard:{},copy:function(t){var r,e={};for(r in t)t.hasOwnProperty(r)&&(e[r]=t[r]);return e},isFunction:function(t){return"function"==typeof t},isString:function(t){return"string"==typeof t},isNumber:function(t){return"number"==typeof t},isObject:function(t){return t instanceof Object},mapKeyboard:function(t){for(var r,e={},n=0,a=t.length;a>n;n++){r=t[n];for(var i=0,s=r.length;s>i;i++)e[r[i]]={x:i,y:n}}return e},merge:function(t,r){for(var e in r)r.hasOwnProperty(e)&&(t[e]=r[e]);return t},getPercentageBetween:function(t,r,e){return t-t*e+r*e},randomCharNear:function(t){var r=this,e=r.mapKeyboard(r.keyboard),n=1,a=[],i=!!t.match(/[A-Z]/);t=t.toLowerCase();var s,o,c=e[t]||[];for(s in e)e.hasOwnProperty(s)&&s!==t&&(o=e[s],Math.abs(c.x-o.x)<=n&&Math.abs(c.y-o.y)<=n&&a.push(s));var u=a.length>0?a[r.randomNumber(0,a.length-1)]:r.randomChar();return i?u.toUpperCase():u},randomChar:function(){var t=this,r=t.keyboard.join("");return r.charAt(t.randomNumber(0,r.length-1))},randomNumber:function(t,r){return Math.floor(Math.random()*(r-t+1))+t},randomFloat:function(t,r){return Math.round(10*(Math.random()*(r-t)+t))/10},hasClass:function(t,r){return t.classList?t.classList.contains(r):new RegExp("(^| )"+r+"( |$)","gi").test(t.className)},addClass:function(t,r){t.classList?t.classList.add(r):t.className+=" "+r},removeClass:function(t,r){t.classList?t.classList.remove(r):t.className=t.className.replace(new RegExp("(^|\\b)"+r.split(" ").join("|")+"(\\b|$)","gi")," ")}},train:function(t){var r=this,e={experience:.6,voice:function(t){console.log(t)},model:"",htmlStartTags:[],htmlEndTags:[]};return t=r.utils.merge(e,t),r.utils.isNumber(t.speed)||(t.speed=t.experience),r.utils.isNumber(t.accuracy)||(t.accuracy=t.experience),r.utils.isNumber(t.invincibility)||(t.invincibility=10*t.accuracy),t},describe:function(t,e,n){var a=this,i={name:t};return a.utils.isNumber(e)?i.experience=e:a.utils.isObject(e)&&(i=a.utils.merge(i,e)),void 0!==n&&(i.voice=a.utils.isString(n)?r.querySelector(n):n),a.casting[t]=a.train(i),a},write:function(){for(var t,r=this,e=Array.prototype.splice.apply(arguments,[0]),n=0,a=e.length;a>n;n++)if(t=e[n],r.utils.isString(t)){var i=t.split(":"),s=i.length>1&&"\\"!==i[0].charAt(i[0].length-1),o=s?i.shift().trim():null,c=i.join(":").replace(/\\:/g,":");s&&r.write({name:"actor",args:[o]}),r.options.erase&&s&&r.write({name:"erase"}),r.write({name:"say",args:[c,!s]})}else"number"==typeof t?r.write(0>t?{name:"erase",args:[t]}:{name:"wait",args:[t]}):"function"==typeof t?r.write({name:"call",args:[t]}):t instanceof Object&&r.scenario.push(t);return r.options.autoplay&&r.play(),r},play:function(t){var r=this;return t===!0&&(r.scene=-1),"ready"===r.state&&r.next(),r},on:function(t,r){var e=this;t=t.split(",");for(var n,a=0,i=t.length;i>a;a++)n=t[a]=t[a].trim(),(e.events[n]||(e.events[n]=[])).push(r);return e},emit:function(t,r,e){var n=this;n.utils.isString(r)?void 0!==r&&void 0===e&&(e=r):r=void 0;var a=t+(r?":"+r:"");return n.trigger(a,e).trigger("*",[a].concat(e)),n},trigger:function(t,r){var e=this,n=e.events[t]||[];r instanceof Array||(r=[r]);for(var a=0,i=n.length;i>a;a++)n[a].apply(e,[t].concat(r));return e},call:function(t,r){var e=this;return t.apply(e),r?e:e.next()},next:function(){var t=this,r=t.scenario[t.scene];if(r&&t.emit(r.name,"end",[r.name].concat(r.args)),t.scene+1>=t.scenario.length)t.state="ready";else{t.state="playing";var e=t.scenario[++t.scene];t.emit(e.name,"start",[e.name].concat(e.args)),t[e.name].apply(t,e.args)}return t},actor:function(t){var r=this;return r.current=r.casting[t],r.next()},say:function(t,r){var e,n,a=this,i=!1,s=a.current.invincibility;r?(n=a.current.model,e=a.current.model.length-1,t=n+t):(n=a.current.model="",e=-1),a.parseHTML(t),t=a.stripHTML(t);var o=setTimeout(function c(){var r,u,l=n.charAt(e);i?(s=a.current.invincibility,i=!1,r=null,u=n=n.substr(0,e),e--):(e++,r=t.charAt(e),--s<0&&(l!==r||a.current.accuracy<=.3)&&a.isMistaking()&&(r=a.utils.randomCharNear(r)),r!==t.charAt(e)&&(i=!0),u=n+=r),u=a.injectHTML(u,e),a.set(u,[u,r,l,t]),i||e<t.length?o=setTimeout(c,a.getSayingSpeed()):a.next()},a.getSayingSpeed());return a},erase:function(t){var r=this;if(!r.utils.isString(r.current.model))return r.next();{var e=r.stripHTML(r.current.model),n=e.length,a=0>t?n+1+t:0;setTimeout(function i(){var t=e.charAt(n),s=e.substr(0,--n);s=r.injectHTML(s,n),r.set(s,[s,null,t,s]),e=r.stripHTML(s),n>=a?setTimeout(i,r.getSayingSpeed(.2,!0)):r.next()},r.getSayingSpeed(.2,!0))}return r},wait:function(t){var r=this;return setTimeout(function(){r.next()},t),r}},e.prototype.keyboards.en=["qwertyuiop","asdfghjkl","zxcvbnm"],e.prototype.keyboards.fr=["azertyuiop","qsdfghjklm","wxcvbn"],t.TheaterJS=e}(window,document);